{% extends "base.html" %}
{% block content %}
<div style="max-width:1000px;margin:0 auto">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <div>
            <h1 style="margin:0 0 6px">Client Preferences</h1>
            <div class="muted">View and manage preferences for all your clients</div>
        </div>
        <a href="{{ url_for('dashboard') }}" class="btn">Back to Dashboard</a>
    </div>

    {% if preferences|length > 0 %}
    <div class="card" style="margin-bottom:20px">
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid rgba(25,49,39,0.08)">
            <button class="btn gm-client-select" data-client-id="all" style="background:var(--gm-primary);color:#fff;border:none">All Clients</button>
            {% for pref in preferences %}
                <button class="btn btn-light gm-client-select" data-client-id="{{ pref.client_id }}" style="background:transparent;border:1px solid rgba(25,49,39,0.08)">{{ pref.client.name }}</button>
            {% endfor %}
        </div>

        <div id="preferences-container">
            {# Show all clients by default #}
            <div id="all-clients" style="display:block">
                <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:16px">
                    {% for pref in preferences %}
                    <div class="card" style="display:flex;flex-direction:column">
                        <div style="margin-bottom:16px">
                            <h4 style="margin:0 0 12px;font-size:1.1rem">{{ pref.client.name }}</h4>
                            <div style="display:grid;gap:10px;margin-bottom:12px">
                                <div style="display:flex;gap:8px">
                                    <span style="font-size:0.85rem;color:#6b7a71;font-weight:600;min-width:100px">Location:</span>
                                    <span style="font-weight:500">{{ pref.location or '—' }}</span>
                                </div>
                                <div style="display:flex;gap:8px">
                                    <span style="font-size:0.85rem;color:#6b7a71;font-weight:600;min-width:100px">Type:</span>
                                    <span style="font-weight:500">{{ (pref.subdivision_type.replace('_', ' ').title()) if pref.subdivision_type else '—' }}</span>
                                </div>
                                <div style="display:flex;gap:8px">
                                    <span style="font-size:0.85rem;color:#6b7a71;font-weight:600;min-width:100px">Budget:</span>
                                    <span style="font-weight:500">€{{ pref.min_budget|format_price if pref.min_budget else '?' }} — €{{ pref.max_budget|format_price if pref.max_budget else '?' }}</span>
                                </div>
                                <div style="display:flex;gap:8px">
                                    <span style="font-size:0.85rem;color:#6b7a71;font-weight:600;min-width:100px">Size:</span>
                                    <span style="font-weight:500">{{ pref.min_m2|format_number }} — {{ pref.max_m2|format_number }} m²</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top:auto;padding-top:12px;border-top:1px solid rgba(25,49,39,0.08)">
                            <a href="{{ url_for('preferences_view', client_id=pref.client_id) }}" class="btn btn-success">View Preferences</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {# Individual client detail view #}
            {% for pref in preferences %}
            <div class="pref-detail card" id="client-{{ pref.client_id }}" data-client-id="{{ pref.client_id }}" style="display:none">
                <div style="margin-bottom:20px">
                    <h3 style="margin:0 0 16px">{{ pref.client.name }}</h3>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px">
                        <div>
                            <div style="font-size:0.9rem;color:#6b7a71;font-weight:600;margin-bottom:8px">LOCATION</div>
                            <div style="font-size:1.1rem;font-weight:600;color:#193127">{{ pref.location or '—' }}</div>
                        </div>
                        <div>
                            <div style="font-size:0.9rem;color:#6b7a71;font-weight:600;margin-bottom:8px">SUBDIVISION TYPE</div>
                            <div style="font-size:1.1rem;font-weight:600;color:#193127">{{ (pref.subdivision_type.replace('_', ' ').title()) if pref.subdivision_type else '—' }}</div>
                        </div>
                        <div>
                            <div style="font-size:0.9rem;color:#6b7a71;font-weight:600;margin-bottom:8px">BUDGET RANGE</div>
                            <div style="font-size:1.1rem;font-weight:600;color:#1f6f4a">€{{ pref.min_budget|format_price if pref.min_budget else '?' }} — €{{ pref.max_budget|format_price if pref.max_budget else '?' }}</div>
                        </div>
                        <div>
                            <div style="font-size:0.9rem;color:#6b7a71;font-weight:600;margin-bottom:8px">SIZE RANGE</div>
                            <div style="font-size:1.1rem;font-weight:600;color:#193127">{{ pref.min_m2|format_number }} — {{ pref.max_m2|format_number }} m²</div>
                        </div>
                    </div>
                </div>
                <div style="border-top:1px solid rgba(25,49,39,0.08);padding-top:16px">
                    <a href="{{ url_for('preferences_view', client_id=pref.client_id) }}" class="btn btn-success">View Preferences</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="card" style="text-align:center;padding:32px">
        <p style="font-size:1.1rem;color:#6b7a71;margin-bottom:16px">You don't have any clients with preferences yet.</p>
        <a href="{{ url_for('clients_list') }}" class="btn btn-success">Add a Client</a>
    </div>
    {% endif %}
</div>

<script>
    (function(){
        const buttons = document.querySelectorAll('.gm-client-select');
        const allClientsView = document.getElementById('all-clients');
        const details = document.querySelectorAll('.pref-detail');
        
        function hideAll(){
            allClientsView.style.display = 'none';
            details.forEach(d=>d.style.display='none');
        }
        
        function resetButtons(){
            buttons.forEach(b => {
                b.style.background = 'transparent';
                b.style.color = 'var(--gm-primary)';
                b.style.border = '1px solid rgba(25,49,39,0.08)';
            });
        }
        
        buttons.forEach(b=>{
            b.addEventListener('click', ()=>{
                const id = b.getAttribute('data-client-id');
                resetButtons();
                
                if(id === 'all'){
                    allClientsView.style.display = 'block';
                    details.forEach(d=>d.style.display='none');
                    b.style.background = 'var(--gm-primary)';
                    b.style.color = '#fff';
                    b.style.border = 'none';
                } else {
                    allClientsView.style.display = 'none';
                    details.forEach(d=>d.style.display='none');
                    const el = document.getElementById('client-'+id);
                    if(el) el.style.display='block';
                    b.style.background = 'var(--gm-primary)';
                    b.style.color = '#fff';
                    b.style.border = 'none';
                }
            });
        });
    })();
</script>
{% endblock %}
