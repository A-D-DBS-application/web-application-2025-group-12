{% extends "base_new.html" %}
{% block title %}Client Preferences{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-1">Client Preferences</h1>
            <p class="text-muted mb-0">View and manage preferences for all your clients</p>
        </div>
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">← Back to Dashboard</a>
    </div>

    {% if preferences|length > 0 %}
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="d-flex flex-wrap gap-2 mb-3 pb-3 border-bottom">
                <button class="btn btn-success gm-client-select" data-client-id="all">All Clients</button>
                {% for pref in preferences %}
                    <button class="btn btn-outline-success gm-client-select" data-client-id="{{ pref.client_id }}">{{ pref.client.name }}</button>
                {% endfor %}
            </div>

        <div id="preferences-container">
            {# Show all clients by default #}
            <div id="all-clients" style="display:block">
                <div class="row row-cols-1 row-cols-md-2 g-4">
                    {% for pref in preferences %}
                    <div class="col">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">{{ pref.client.name }}</h5>
                                <div class="mb-2"><span class="text-muted">Location:</span> <strong>{{ pref.location or '—' }}</strong></div>
                                <div class="mb-2"><span class="text-muted">Type:</span> <strong>{{ (pref.subdivision_type.replace('_', ' ').title()) if pref.subdivision_type else '—' }}</strong></div>
                                <div class="mb-2"><span class="text-muted">Budget:</span> <strong>€{{ pref.min_budget|format_price if pref.min_budget else '?' }} — €{{ pref.max_budget|format_price if pref.max_budget else '?' }}</strong></div>
                                <div><span class="text-muted">Size:</span> <strong>{{ pref.min_m2|format_number }} — {{ pref.max_m2|format_number }} m²</strong></div>
                            </div>
                            <div class="card-footer bg-light">
                                <a href="{{ url_for('preferences_view', client_id=pref.client_id) }}" class="btn btn-sm btn-outline-primary">View Preferences</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {# Individual client detail view #}
            {% for pref in preferences %}
            <div class="pref-detail card" id="client-{{ pref.client_id }}" data-client-id="{{ pref.client_id }}" style="display:none">
                <div class="card-body">
                    <h3 class="card-title">{{ pref.client.name }}</h3>
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <div class="text-muted small">LOCATION</div>
                            <div class="fw-semibold">{{ pref.location or '—' }}</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-muted small">SUBDIVISION TYPE</div>
                            <div class="fw-semibold">{{ (pref.subdivision_type.replace('_', ' ').title()) if pref.subdivision_type else '—' }}</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-muted small">BUDGET RANGE</div>
                            <div class="fw-semibold text-success">€{{ pref.min_budget|format_price if pref.min_budget else '?' }} — €{{ pref.max_budget|format_price if pref.max_budget else '?' }}</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-muted small">SIZE RANGE</div>
                            <div class="fw-semibold">{{ pref.min_m2|format_number }} — {{ pref.max_m2|format_number }} m²</div>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-light">
                    <a href="{{ url_for('preferences_view', client_id=pref.client_id) }}" class="btn btn-sm btn-outline-primary">View Preferences</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="card" style="text-align:center;padding:32px">
        <p style="font-size:1.1rem;color:#6b7a71;margin-bottom:16px">You don't have any clients with preferences yet.</p>
        <a href="{{ url_for('clients_list') }}" class="btn btn-success">Add a Client</a>
    </div>
    {% endif %}
</div>

<script>
    (function(){
        const buttons = document.querySelectorAll('.gm-client-select');
        const allClientsView = document.getElementById('all-clients');
        const details = document.querySelectorAll('.pref-detail');
        
        function hideAll(){
            allClientsView.style.display = 'none';
            details.forEach(d=>d.style.display='none');
        }
        
        function resetButtons(){
            buttons.forEach(b => {
                b.style.background = 'transparent';
                b.style.color = 'var(--gm-primary)';
                b.style.border = '1px solid rgba(25,49,39,0.08)';
            });
        }
        
        buttons.forEach(b=>{
            b.addEventListener('click', ()=>{
                const id = b.getAttribute('data-client-id');
                resetButtons();
                
                if(id === 'all'){
                    allClientsView.style.display = 'block';
                    details.forEach(d=>d.style.display='none');
                    b.style.background = 'var(--gm-primary)';
                    b.style.color = '#fff';
                    b.style.border = 'none';
                } else {
                    allClientsView.style.display = 'none';
                    details.forEach(d=>d.style.display='none');
                    const el = document.getElementById('client-'+id);
                    if(el) el.style.display='block';
                    b.style.background = 'var(--gm-primary)';
                    b.style.color = '#fff';
                    b.style.border = 'none';
                }
            });
        });
    })();
</script>
{% endblock %}
