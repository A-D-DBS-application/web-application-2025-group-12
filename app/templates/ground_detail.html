{% extends "base.html" %}
{% from 'macros/layout.html' import detail_field_primary, detail_field, detail_grid_2col, section_divider %}
{% from 'macros/forms.html' import page_header %}

{% block content %}
<div class="page-wrapper-medium">
    {% if ground %}
    <div class="card mb-4">
        {# Page Header #}
        {{ page_header("Building Plot Details", "View complete information about this building plot") }}
        
        {# Two-column layout: Image and Details #}
        {% call detail_grid_2col('lg') %}
            {# Plot Image #}
            <div>
                {% if ground.photo_url %}
                <img src="{{ ground.photo_url }}" alt="{{ ground.location }}" class="detail-image">
                {% else %}
                <img src="{{ url_for('ground_image', ground_id=ground.id) }}" alt="{{ ground.location }}" class="detail-image">
                {% endif %}
            </div>
            
            {# Plot Details #}
            <div>
                {# Location and Address #}
                <div class="detail-field">
                    <div class="detail-label">LOCATION</div>
                    <div class="detail-value detail-value-lg">{{ ground.location }}</div>
                    {% if ground.address %}
                    <div class="detail-value-muted">{{ ground.address }}</div>
                    {% endif %}
                </div>
                
                {# Surface Area and Price Grid #}
                {% call detail_grid_2col() %}
                    {{ detail_field_primary("SURFACE AREA", ground.m2|format_number ~ " m²") }}
                    {{ detail_field_primary("PRICE", "€" ~ ground.budget|format_price) }}
                {% endcall %}
                
                {# Subdivision Type #}
                {{ detail_field("SUBDIVISION TYPE", ground.subdivision_type.replace('_', ' ').title()) }}
                
                {# Owner #}
                {{ detail_field("OWNER", ground.owner, False) }}
            </div>
        {% endcall %}
        
        {# Action Buttons Section #}
        {% if session.role == 'company' %}
            {% call section_divider() %}
                <a id="detail-back-btn" href="{{ url_for('grounds_list') }}" class="btn">Back to Plots</a>
                {# Show Edit/Delete only for grounds owned by this company #}
                {% if user_company and ground.provider == user_company %}
                <a href="{{ url_for('ground_edit', ground_id=ground.id) }}" class="btn">Edit Plot</a>
                <form method="POST" action="{{ url_for('ground_delete', ground_id=ground.id) }}" class="inline">
                    <button type="submit" class="btn" onclick="return confirm('Delete this ground? This action cannot be undone.')">Delete Plot</button>
                </form>
                {% endif %}
            {% endcall %}
        {% else %}
            {% call section_divider() %}
                <a id="detail-back-btn" href="{{ url_for('matches_list') }}" class="btn">Back</a>
            {% endcall %}
        {% endif %}

        <script>
        // If the user arrived from the Matches page, make the Back button return there and show shorter label.
        (function(){
            try{
                var ref = document.referrer || '';
                var backBtn = document.getElementById('detail-back-btn');
                if(!backBtn) return;
                if(ref.indexOf('/matches') !== -1){
                    backBtn.href = "{{ url_for('matches_list') }}";
                    backBtn.textContent = 'Back';
                }
            }catch(e){console.warn(e)}
        })();
        </script>
    </div>
    {% endif %}
</div>
{% endblock %}


