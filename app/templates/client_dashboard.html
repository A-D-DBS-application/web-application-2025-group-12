{% extends "base.html" %}

{% block title %}Client Dashboard - {{ client.name }}{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Page Header -->
    <h1 class="display-5 fw-bold mb-4">Welcome, {{ client.name }}</h1>

    <!-- Preferences Card -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Your Preferences</h5>
            {% if preferences %}
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <div class="d-flex">
                            <strong class="me-2">Location:</strong>
                            <span class="text-muted">{{ preferences.location or 'Not set' }}</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex">
                            <strong class="me-2">Budget:</strong>
                            <span class="text-muted">
                                €{{ preferences.min_budget|format_price if preferences.min_budget else '?' }} - 
                                €{{ preferences.max_budget|format_price if preferences.max_budget else '?' }}
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex">
                            <strong class="me-2">Size:</strong>
                            <span class="text-muted">
                                {{ preferences.min_m2|format_number }} - {{ preferences.max_m2|format_number }} m²
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex">
                            <strong class="me-2">Type:</strong>
                            <span class="text-muted">
                                {{ (preferences.subdivision_type.replace('_', ' ').title()) if preferences.subdivision_type else 'Not set' }}
                            </span>
                        </div>
                    </div>
                </div>
                <a href="{{ url_for('client_preferences_edit') }}" class="btn btn-edit-outline pref-action">Edit Preferences</a>
            {% else %}
                <p class="text-muted mb-3">No preferences set yet.</p>
                <a href="{{ url_for('client_preferences_edit') }}" class="btn btn-primary">Set Preferences</a>
            {% endif %}
        </div>
    </div>

    <!-- Matches Card -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title mb-4">
                Your Matches 
                <span class="badge bg-secondary">{{ matches|length }}</span>
            </h5>
            {% if matches %}
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    {% for match in matches %}
                    <div class="col">
                        <div class="card ground-card h-100 shadow-sm">
                            <img src="{{ match.ground.image_url or url_for('ground_image', ground_id=match.ground.id) }}" 
                                 class="card-img-top" 
                                 alt="{{ match.ground.location }}">
                            <div class="card-body">
                                <h6 class="card-title">{{ match.ground.location }}</h6>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted small">{{ match.ground.m2|format_number }} m²</span>
                                    <span class="text-success fw-bold small">€{{ match.ground.budget|format_price }}</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="badge bg-info small">
                                        {{ match.ground.subdivision_type.replace('_', ' ').title() }}
                                    </span>
                                    <span class="text-muted small">{{ match.ground.owner }}</span>
                                </div>
                                <div class="text-center mt-2">
                                    <strong class="text-success">Match Score: {{ match|match_percent }}%</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <h5>No matches yet</h5>
                    <p class="text-muted">Ask your company to run the matching algorithm.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title mb-3">Quick Actions</h5>
            <div class="d-flex gap-2 flex-wrap">
                <a href="{{ url_for('matches_list') }}" class="btn btn-outline-secondary pref-action">View All My Matches</a>
                <a href="{{ url_for('client_preferences_edit') }}" class="btn btn-outline-secondary pref-action">Update My Preferences</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
