{% extends "base.html" %}
{% block content %}
<div class="container py-3">

    {% if ground and not is_edit %}
    {# ---------------------------- #
       DETAIL VIEW FOR EXISTING PLOT
       ---------------------------- #}
    <div class="card mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h1 class="h3 mb-0">Building Plot Details</h1>
                <div class="text-muted">View complete information about this building plot</div>
            </div>
        </div>

        <div class="row g-4 mb-3">
            <div>
                {% if ground.image_url %}
                 <img src="{{ ground.image_url }}"
                     alt="{{ ground.location }}"
                     class="img-fluid rounded shadow-sm ground-detail-image">
                {% endif %}
            </div>

            <div>
                <div class="mb-3">
                    <div class="small text-muted fw-semibold mb-1">LOCATION</div>
                    <div class="h5 fw-bold text-dark">{{ ground.location }}</div>
                </div>

                {% if ground.address %}
                <div class="mb-3">
                    <div class="small text-muted fw-semibold mb-1">ADDRESS</div>
                    <div class="fw-semibold text-dark">{{ ground.address }}</div>
                </div>
                {% endif %}

                <div class="row g-3 mb-3">
                    <div>
                        <div class="small text-muted fw-semibold mb-1">SURFACE AREA</div>
                        <div class="fw-bold text-success">{{ ground.m2 }} m²</div>
                    </div>
                    <div>
                        <div class="small text-muted fw-semibold mb-1">PRICE</div>
                        <div class="fw-bold text-success">€{{ ground.budget|format_price }}</div>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="small text-muted fw-semibold mb-1">SUBDIVISION TYPE</div>
                    <div class="fw-semibold text-dark">{{ ground.subdivision_type }}</div>
                </div>

                <div>
                    <div class="small text-muted fw-semibold mb-1">OWNER</div>
                    <div class="fw-semibold text-dark">{{ ground.owner }}</div>
                </div>
            </div>
        </div>

        {% if session.role == 'company' %}
        <div class="d-flex gap-2 border-top pt-3">
            <a href="{{ url_for('grounds_list') }}" class="btn btn-outline-secondary">← Back to Plots</a>
            <form method="POST" action="{{ url_for('ground_delete', ground_id=ground.id) }}" class="d-inline">
                <button type="submit" class="btn btn-danger"
                        onclick="return confirm('Delete this ground? This action cannot be undone.')">
                    × Delete Plot
                </button>
            </form>
        </div>
        {% else %}
        <div class="border-top pt-3">
            <a href="{{ url_for('grounds_list') }}" class="btn btn-outline-secondary">← Back to Plots</a>
        </div>
        {% endif %}
    </div>

     {% else %}
     {# ------------------------- #
         ADD NEW / EDIT FORM
         ------------------------- #}

    <div class="card">
        <div class="card-body">
            <h2 class="h4 mb-3">{% if ground %}Edit{% else %}Add New{% endif %} Building Plot</h2>

            <form method="POST" enctype="multipart/form-data">

                <div class="mb-3">
                    <label class="form-label">Location (City/Municipality)</label>
                    <input type="text" name="location" class="form-control" placeholder="e.g., Ghent" required
                           value="{{ ground.location if ground else '' }}">
                </div>

                <div class="mb-3">
                    <label class="form-label">Address (Street + Number)</label>
                    <input type="text" name="address" class="form-control" placeholder="e.g., Main Street 123"
                           value="{{ ground.address if ground else '' }}">
                </div>

                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Surface Area (m²)</label>
                        <input type="number" name="m2" class="form-control" placeholder="e.g., 5000" required
                               value="{{ ground.m2 if ground else '' }}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Budget (€)</label>
                        <input type="number" step="0.01" name="budget" class="form-control" placeholder="e.g., 500000" required
                               value="{{ ground.budget if ground else '' }}">
                    </div>
                </div>

                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Subdivision Type</label>
                        <select name="subdivision_type" class="form-select" required>
                            <option value="">Select type...</option>
                            {% for type in subdivision_types %}
                            <option value="{{ type }}" {% if ground and ground.subdivision_type == type %}selected{% endif %}>
                                {{ type.replace('_', ' ').title() }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Owner</label>
                        <input type="text" name="owner" class="form-control" placeholder="Enter owner name" required
                               value="{{ ground.owner if ground else '' }}">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Photo</label>
                    <input type="file" name="photo" accept="image/*" class="form-control">
                    {% if ground and ground.image_url %}
                    <div class="mt-2">
                        <img src="{{ ground.image_url }}" alt="Current photo" class="img-thumbnail ground-thumb">
                    </div>
                    {% endif %}
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                        ✓ {% if ground %}Update{% else %}Add{% endif %} Plot
                    </button>
                    <a href="{{ url_for('grounds_list') }}" class="btn btn-outline-secondary">← Back to Plots</a>
                </div>

            </form>
        </div>
    </div>

    {% endif %}
</div>
{% endblock %}


