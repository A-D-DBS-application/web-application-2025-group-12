{% extends "base.html" %}
{% block content %}
<div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">
        <div>
            <h1 style="margin:0">Review Matches</h1>
            <div class="muted">Select which matches to approve for your clients</div>
        </div>
        <a href="{{ url_for('dashboard') }}" class="btn">Back to Dashboard</a>
    </div>

    {% if client_matches %}
    <form method="POST">
        {% for client, matches in client_matches.items() %}
        <div class="card" style="margin-bottom:24px">
            <h3 style="margin-top:0">{{ client.name }}</h3>
            <div class="muted" style="margin-bottom:12px">Top {{ matches|length }} matches (best scores first)</div>
            
            <div style="display:grid;gap:12px">
                {% for match in matches %}
                <div class="card" style="padding:12px;display:flex;align-items:center;gap:12px">
                    <input type="checkbox" name="approved_matches" value="{{ match.id }}" {% if match.status == 'approved' %}checked{% endif %} style="width:20px;height:20px">
                    <input type="hidden" name="displayed_matches" value="{{ match.id }}">
                    <img src="{% if match.ground.photo_url %}{{ match.ground.photo_url }}{% else %}{{ url_for('ground_image', ground_id=match.ground.id) }}{% endif %}" alt="{{ match.ground.location }}" style="width:100px;height:60px;object-fit:cover;border-radius:6px">
                    <div style="flex:1">
                        <div style="font-weight:700">{{ match.ground.location }}</div>
                        <div class="muted">{{ match.ground.address or 'Address not specified' }}</div>
                        <div class="muted">{{ match.ground.m2|format_number }} m² • €{{ match.ground.budget|format_price }} • {{ match.ground.subdivision_type.replace('_', ' ').title() }}</div>
                    </div>
                    <div style="text-align:right">
                        <div class="tag info" style="font-size:18px;font-weight:600">{{ (match.total_score or 0)|round(0)|int }}%</div>
                        <div class="muted" style="margin-top:4px;font-size:0.85rem">
                            M2: {{ (match.m2_score or 0)|round(0)|int }}% • 
                            Budget: {{ (match.budget_score or 0)|round(0)|int }}%<br>
                            Location: {{ (match.location_score or 0)|round(0)|int }}% • 
                            Type: {{ (match.type_score or 0)|round(0)|int }}%
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        
        <div style="display:flex;gap:12px;margin-top:24px">
            <button type="submit" class="btn btn-success">Save Approvals</button>
            <a href="{{ url_for('matches_list') }}" class="btn">View All Matches</a>
        </div>
    </form>
    {% else %}
    <div class="card" style="text-align:center;padding:24px">
        <p class="muted">No matches found. Run the matching algorithm first.</p>
        <form method="POST" action="{{ url_for('match_run') }}" style="display:inline">
            <button type="submit" class="btn primary">Run Match Algorithm</button>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
