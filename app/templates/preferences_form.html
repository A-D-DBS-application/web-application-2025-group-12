{# ===========================================================================
   UNIFIED PREFERENCES FORM
   
   This template is used by BOTH company users (editing client preferences)
   and client users (editing their own preferences). The template adapts
   based on session.role to show appropriate titles and cancel URLs.
   
   Variables expected:
   - pref: Preferences object (may be None for new preferences)
   - client: Client object (for company role, shows client name)
   - subdivision_types: List of available subdivision types (for dropdown)
   
   NOTE: All styling uses CSS classes from global.css. No inline styles.
   =========================================================================== #}
{% extends "base.html" %}
{% from 'macros/forms.html' import form_field, form_row_2col, form_actions, form_label, form_select, page_header %}

{% block content %}
<div class="page-wrapper-narrow">
    {{ page_header(
        "Edit Preferences" if session.role == 'company' else "Edit Your Preferences",
        "Manage preferences for " ~ client.name if session.role == 'company' else "Update your property search criteria"
    ) }}

    <div class="card">
        <form method="POST">
            {# Location field #}
            {{ form_field("Location", "location", "text", "e.g., Amsterdam, Rotterdam", pref.location if pref else '') }}

            {# Subdivision Type - dropdown for clients, text input for companies #}
            <div class="form-field">
                {{ form_label("Subdivision Type") }}
                {% if session.role == 'client' and subdivision_types %}
                    {{ form_select("subdivision_type", subdivision_types, pref.subdivision_type if pref else '', "Any type...") }}
                {% else %}
                    <input type="text" 
                           name="subdivision_type" 
                           class="form-input"
                           placeholder="e.g., Residential, Commercial, Mixed-Use" 
                           value="{{ pref.subdivision_type if pref else '' }}">
                {% endif %}
            </div>

            {# Min/Max Size (m²) #}
            {{ form_row_2col(
                "Min Size (m²)", "min_m2", pref.min_m2 if pref else '',
                "Max Size (m²)", "max_m2", pref.max_m2 if pref else '',
                "number", None, "e.g., 1000", "e.g., 10000"
            ) }}

            {# Min/Max Budget (€) #}
            {{ form_row_2col(
                "Min Budget (€)", "min_budget", pref.min_budget if pref else '',
                "Max Budget (€)", "max_budget", pref.max_budget if pref else '',
                "number", "1", "e.g., 100000", "e.g., 1000000"
            ) }}

            {# Action buttons - different cancel URLs based on role #}
            {% if session.role == 'company' %}
                {{ form_actions("Save Changes", url_for('preferences_list'), "Cancel") }}
            {% else %}
                {{ form_actions("Save Changes", url_for('client_dashboard'), "Cancel") }}
            {% endif %}
        </form>
    </div>
</div>
{% endblock %}
