{# ===========================================================================
   UNIFIED PREFERENCES FORM
   
   This template is used by BOTH company users (editing client preferences)
   and client users (editing their own preferences). The template adapts
   based on session.role to show appropriate titles and cancel URLs.
   
   Variables expected:
   - pref: Preferences object (may be None for new preferences)
   - client: Client object (for company role, shows client name)
   - subdivision_types: List of available subdivision types (for dropdown)
   
   NOTE: Modernized to Bootstrap 5 without macros for better client experience.
   =========================================================================== #}
{% extends "base_new.html" %}

{% block title %}{{ "Edit Preferences" if session.role == 'company' else "Edit Your Preferences" }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
            <!-- Header -->
            <div class="mb-4">
                <h1 class="display-6 fw-bold mb-2">
                    {{ "Edit Preferences" if session.role == 'company' else "Edit Your Preferences" }}
                </h1>
                <p class="text-muted">
                    {% if session.role == 'company' %}
                        Manage preferences for {{ client.name if client else 'client' }}
                    {% else %}
                        Update your property search criteria
                    {% endif %}
                </p>
            </div>

            <!-- Preferences Form -->
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <form method="POST">
                        <!-- Location -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Location</label>
                            <input type="text" 
                                   name="location" 
                                   class="form-control" 
                                   placeholder="e.g., Amsterdam, Rotterdam" 
                                   value="{{ pref.location if pref else '' }}">
                        </div>

                        <!-- Subdivision Type -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Subdivision Type</label>
                            {% if session.role == 'client' and subdivision_types %}
                                <select name="subdivision_type" class="form-select">
                                    <option value="">Any type...</option>
                                    {% for type in subdivision_types %}
                                        <option value="{{ type }}" {% if pref and pref.subdivision_type == type %}selected{% endif %}>
                                            {{ type.replace('_', ' ').title() }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% else %}
                                <input type="text" 
                                       name="subdivision_type" 
                                       class="form-control"
                                       placeholder="e.g., Detached, Semi-detached, Apartment" 
                                       value="{{ pref.subdivision_type if pref else '' }}">
                            {% endif %}
                        </div>

                        <!-- Size Range -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Min Size (m²)</label>
                                <input type="number" 
                                       name="min_m2" 
                                       class="form-control" 
                                       placeholder="e.g., 1000" 
                                       value="{{ pref.min_m2 if pref else '' }}">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Max Size (m²)</label>
                                <input type="number" 
                                       name="max_m2" 
                                       class="form-control" 
                                       placeholder="e.g., 10000" 
                                       value="{{ pref.max_m2 if pref else '' }}">
                            </div>
                        </div>

                        <!-- Budget Range -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Min Budget (€)</label>
                                <input type="number" 
                                       name="min_budget" 
                                       class="form-control" 
                                       placeholder="e.g., 100000" 
                                       min="1" 
                                       value="{{ pref.min_budget if pref else '' }}">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Max Budget (€)</label>
                                <input type="number" 
                                       name="max_budget" 
                                       class="form-control" 
                                       placeholder="e.g., 1000000" 
                                       min="1" 
                                       value="{{ pref.max_budget if pref else '' }}">
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-3 mt-4">
                            <button type="submit" class="btn btn-success">✓ Save Changes</button>
                            {% if session.role == 'company' %}
                                <a href="{{ url_for('preferences_list') }}" class="btn btn-outline-secondary">← Back to Preferences</a>
                            {% else %}
                                <a href="{{ url_for('client_dashboard') }}" class="btn btn-outline-secondary main-action">← Back to Dashboard</a>
                            {% endif %}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
